<!DOCTYPE html>
<html>
  <head>
    <title>Test Username Validation</title>
    <style>
      .username-feedback {
        margin-top: 8px;
        font-size: 0.8125rem;
        font-weight: 500;
      }
      .username-feedback.checking {
        color: #94a3b8;
      }
      .username-feedback.available {
        color: #059669;
      }
      .username-feedback.taken {
        color: #ef4444;
      }
    </style>
  </head>
  <body>
    <h1>Test Username Validation</h1>
    <div>
      <label>Owner Username</label><br />
      <input type="text" id="username-input" placeholder="Type a username" />
      <div id="username-feedback" class="username-feedback"></div>
    </div>

    <script>
      const usernameInput = document.getElementById("username-input");
      const usernameFeedback = document.getElementById("username-feedback");

      console.log("usernameInput:", usernameInput);
      console.log("usernameFeedback:", usernameFeedback);

      if (usernameInput && usernameFeedback) {
        let checkTimeout;

        usernameInput.addEventListener("input", function () {
          console.log("Input event fired, value:", this.value);
          clearTimeout(checkTimeout);
          const username = this.value.trim();

          if (username.length < 3) {
            usernameFeedback.className = "username-feedback";
            usernameFeedback.textContent = "";
            return;
          }

          usernameFeedback.className = "username-feedback checking";
          usernameFeedback.textContent = "Checking...";

          checkTimeout = setTimeout(() => {
            console.log("Checking username:", username);
            checkUsername(username);
          }, 500);
        });

        function checkUsername(username) {
          fetch("check_username.php", {
            method: "POST",
            headers: {
              "Content-Type": "application/x-www-form-urlencoded",
            },
            body: "username=" + encodeURIComponent(username),
          })
            .then((response) => {
              console.log("Response received:", response);
              return response.json();
            })
            .then((data) => {
              console.log("Data:", data);
              if (data.available) {
                usernameFeedback.className = "username-feedback available";
                usernameFeedback.textContent = "✓ " + data.message;
              } else {
                usernameFeedback.className = "username-feedback taken";
                usernameFeedback.textContent = "✗ " + data.message;
              }
            })
            .catch((error) => {
              console.error("Error:", error);
              usernameFeedback.className = "username-feedback";
              usernameFeedback.textContent = "Error checking username";
            });
        }
      } else {
        console.error("Elements not found!");
      }
    </script>
  </body>
</html>
